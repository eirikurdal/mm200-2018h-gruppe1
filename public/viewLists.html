<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>M2A1 objekt</title>
    <link href="css/styles.css" rel="stylesheet" />
</head>

<body>
    <div id="createListContainer">
        <h1>Create New List</h1>
        <form id="newListForm">
            <label for="listTitle">Tittel:</label>
            <input id="listTitle" type="text" required>
            <br>

            <button id="btnCreateList">Lag liste</button>
        </form>
    </div>
    <div id="listContainer">
    </div>
    <script>
        // HTML-ELEMENTS ----------------
        let newListForm = document.getElementById("newListForm");
        newListForm.onsubmit = createList;

        let listContainer = document.getElementById("listContainer");

        // Endpoints ---------------------------------------------
        const ADD_NEW_LIST_ENDPOINT = '/lists/add';
        const GET_ALL_LISTS_ENDPOINT = '/lists/get';
        const DELETE_LIST_ENDPOINT = '/lists/delete';

        // ADD new list elements --------
        const INPUT_LIST_TITLE = "listTitle";

        // OUTPUT elements ----------------------
        const OUTPUT_LIST_CONTAINER = "listContainer";


        //---------------------------------------------------------
        // FUNCTIONS ----------------------------------------------
        //---------------------------------------------------------


        // Add new list ----------------
        function createList(evt) {
            evt.preventDefault();

            let userId = localStorage.getItem("id");
            let token = localStorage.getItem("token");

            let listTitle = document.getElementById(INPUT_LIST_TITLE).value;

            let list = {
                listTitle: listTitle
            };

            sendListToDB(list, userId, token).then(response => {
                if (response.status !== 200) {
                    window.alert(response.msg);
                    showLists();
                }
            });

        }

        function sendListToDB(list, userId, token) {

            return fetch(ADD_NEW_LIST_ENDPOINT, {
                method: "POST",
                headers: {
                    'Content-Type': 'application/json; charset=utf-8',
                    'Accept': 'application/json',
                    'Auth': token,
                    'UserId': userId
                },
                body: JSON.stringify(list)
            }).then(data => {
                return data.json();
            });
        }

        // Show all lists ----------------------
        function showLists() {

            let userId = localStorage.getItem("id");
            let token = localStorage.getItem("token");

            getAllListsFromDB(userId, token).then(response => {
                if (response.status !== 200) {
                    let lists = response.lists;
                    console.log(lists);

                    let listContainer = document.getElementById("listContainer");
                    listContainer.innerHTML = "";

                    for (let i = 0; i < lists.length; i++) {
                        let html = "";
                        html += `<div>`;
                        html += `<h3>${lists[i].title}</h3>`
                        html += `</div>`;

                        listContainer.innerHTML += html;

                    }
                }
            });

        }


        function getAllListsFromDB(userId, token) {

            return fetch(GET_ALL_LISTS_ENDPOINT, {
                method: "GET",
                headers: {
                    'Content-Type': 'application/json; charset=utf-8',
                    'Accept': 'application/json',
                    'Auth': token,
                    'UserId': userId
                },
            }).then(data => {
                return data.json();
            });
        }
    </script>
</body>

</html>

<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <meta charset="utf-8">
    <title>Lists</title>

    <!-- My Styles -->
    <link href="css/styles_simple.css" rel="stylesheet" />
    <link href="css/styles_lists.css" rel="stylesheet" />


    <!-- FONT AWESOME -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
</head>

<body>
    <div class="header">
        <i class="fas fa-plus-square new-list-icon" onclick="newListPrompt()"></i>
    </div>

    <div id="listContainer">
    </div>
    <script>
        // HTML-ELEMENTS ----------------


        // Endpoints ---------------------------------------------
        const ADD_NEW_LIST_ENDPOINT = '/lists/add';
        const GET_ALL_LISTS_ENDPOINT = '/lists/get';
        const DELETE_LIST_ENDPOINT = '/lists/delete';

        // ADD new list elements --------
        const INPUT_LIST_TITLE = "listTitle";

        // OUTPUT elements ----------------------
        const OUTPUT_LIST_CONTAINER = "listContainer";


        //---------------------------------------------------------
        // FUNCTIONS ----------------------------------------------
        //---------------------------------------------------------

        // New list prompt -------------

        function newListPrompt() {
            let listTitle = prompt("NY LISTE - fyll inn tittel:");
            createList(listTitle);

        }


        // Add new list ----------------
        function createList(listTitle) {

            let userId = localStorage.getItem("id");
            let token = localStorage.getItem("token");

            let list = {
                listTitle: listTitle
            };

            sendListToDB(list, userId, token).then(response => {
                if (response.status !== 200) {
                    window.alert(response.msg);
                    showLists();
                }
            });

        }

        function sendListToDB(list, userId, token) {

            return fetch(ADD_NEW_LIST_ENDPOINT, {
                method: "POST",
                headers: {
                    'Content-Type': 'application/json; charset=utf-8',
                    'Accept': 'application/json',
                    'Auth': token,
                    'UserId': userId
                },
                body: JSON.stringify(list)
            }).then(data => {
                return data.json();
            });
        }

        // Show all lists ----------------------
        function showLists() {

            let userId = localStorage.getItem("id");
            let token = localStorage.getItem("token");

            getAllListsFromDB(userId, token).then(response => {
                if (response.status !== 200) {
                    let lists = response.lists;
                    console.log(lists);

                    let listContainer = document.getElementById("listContainer");
                    listContainer.innerHTML = "";

                    let listeelementer = ["Grøt", "Melk", "jalla", "balla", "Snøscooter", "Bål"];

                    for (let i = 0; i < lists.length; i++) {
                        let html = "";
                        html += `<div class="list-card">`;
                        html += `<h3>${lists[i].title}</h3>`;
                        html += `<ul>`;
                        for (let j = 0; j < listeelementer.length; j++) {
                            html += `<li>${listeelementer[j]}</li>`;
                        }
                        html += `</ul>`;
                        html += `<div class="new-list-element">`;
                        html += `<i class="fas fa-plus new-list-element-icon"></i>`;
                        html += `</div>`;

                        listContainer.innerHTML += html;

                    }
                }
            });
        }


        function getAllListsFromDB(userId, token) {

            return fetch(GET_ALL_LISTS_ENDPOINT, {
                method: "GET",
                headers: {
                    'Content-Type': 'application/json; charset=utf-8',
                    'Accept': 'application/json',
                    'Auth': token,
                    'UserId': userId
                },
            }).then(data => {
                return data.json();
            });
        }

        // INIT =================================
        showLists();

    </script>
</body>

</html>
